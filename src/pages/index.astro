---
import { getCollection } from "astro:content";
import BaseLayout from "@/layouts/BaseLayout.astro";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import { ArrowRight } from "lucide-react";
import { siteConfig } from "@/data/site";

const featuredProjects = (await getCollection("projects"))
  .filter((project) => project.data.featured)
  .sort((a, b) => a.data.order - b.data.order)
  .slice(0, 3);

const recentPosts = (await getCollection("blog"))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);
---

<BaseLayout title={siteConfig.title}>
  <!-- Hero Section -->
  <section class="container mx-auto max-w-5xl px-4 py-16 md:py-24">
    <div class="flex flex-col items-center gap-8 md:flex-row md:items-start">
      <div class="flex-1 space-y-6">
        <div class="space-y-2">
          <p class="text-lg text-primary font-medium">Hello, I'm</p>
          <h1 class="text-4xl font-bold md:text-5xl lg:text-6xl">
            {siteConfig.author}
          </h1>
          <p class="text-xl text-muted-foreground md:text-2xl">
            Software Engineer & Researcher
          </p>
        </div>

        <p class="max-w-xl text-muted-foreground leading-relaxed">
          I'm passionate about building software that makes a difference.
          With expertise in full-stack development and machine learning,
          I create solutions that bridge research and production.
        </p>

        <div class="flex flex-wrap gap-4">
          <Button asChild>
            <a href="/projects">
              View Projects
              <ArrowRight className="ml-2 h-4 w-4" />
            </a>
          </Button>
          <Button variant="outline" asChild>
            <a href="/blog">Read Blog</a>
          </Button>
        </div>

        <div class="flex items-center gap-4 pt-4">
          {siteConfig.social.map((link) => (
            <a
              href={link.href}
              target={link.href.startsWith("mailto:") ? undefined : "_blank"}
              rel={link.href.startsWith("mailto:") ? undefined : "noopener noreferrer"}
              class="text-muted-foreground transition-colors hover:text-primary"
              aria-label={link.name}
            >
              <link.icon className="h-6 w-6" />
            </a>
          ))}
        </div>
      </div>
    </div>
  </section>

  <!-- Featured Projects -->
  {featuredProjects.length > 0 && (
    <section class="border-t border-border bg-card/50">
      <div class="container mx-auto max-w-5xl px-4 py-16">
        <div class="mb-8 flex items-center justify-between">
          <h2 class="text-2xl font-bold md:text-3xl">Featured Projects</h2>
          <a
            href="/projects"
            class="text-sm text-primary hover:underline inline-flex items-center gap-1"
          >
            View all
            <ArrowRight className="h-4 w-4" />
          </a>
        </div>

        <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
          {featuredProjects.map((project) => (
            <a href={`/projects/${project.id}`} class="group">
              <Card className="h-full transition-colors hover:border-primary/50">
                <CardHeader>
                  <CardTitle className="group-hover:text-primary transition-colors">
                    {project.data.title}
                  </CardTitle>
                  <CardDescription>{project.data.description}</CardDescription>
                </CardHeader>
                <CardContent>
                  <div class="flex flex-wrap gap-2">
                    {project.data.tags.slice(0, 4).map((tag) => (
                      <Badge variant="secondary">{tag}</Badge>
                    ))}
                  </div>
                </CardContent>
              </Card>
            </a>
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- Recent Blog Posts -->
  {recentPosts.length > 0 && (
    <section class="border-t border-border">
      <div class="container mx-auto max-w-5xl px-4 py-16">
        <div class="mb-8 flex items-center justify-between">
          <h2 class="text-2xl font-bold md:text-3xl">Recent Posts</h2>
          <a
            href="/blog"
            class="text-sm text-primary hover:underline inline-flex items-center gap-1"
          >
            View all
            <ArrowRight className="h-4 w-4" />
          </a>
        </div>

        <div class="space-y-6">
          {recentPosts.map((post) => (
            <a href={`/blog/${post.id}`} class="group block">
              <Card className="transition-colors hover:border-primary/50">
                <CardHeader>
                  <div class="flex items-center gap-2 text-sm text-muted-foreground mb-2">
                    <time datetime={post.data.pubDate.toISOString()}>
                      {post.data.pubDate.toLocaleDateString("en-US", {
                        year: "numeric",
                        month: "long",
                        day: "numeric",
                      })}
                    </time>
                  </div>
                  <CardTitle className="group-hover:text-primary transition-colors">
                    {post.data.title}
                  </CardTitle>
                  <CardDescription>{post.data.description}</CardDescription>
                </CardHeader>
                <CardContent>
                  <div class="flex flex-wrap gap-2">
                    {post.data.tags.slice(0, 4).map((tag) => (
                      <Badge variant="secondary">{tag}</Badge>
                    ))}
                  </div>
                </CardContent>
              </Card>
            </a>
          ))}
        </div>
      </div>
    </section>
  )}
</BaseLayout>
